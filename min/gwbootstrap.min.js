function matchPageTopToNavbar(){$('.navbar-fixed-top + .container').css('padding-top',$('header').height())}function matchFooterHeight(){const newheight=$('.footer > .container').outerHeight();$footer=$('.footer');fpad=$footer.outerHeight()-$footer.height();$footer.height(newheight+fpad);padtop=parseInt($footer.css('padding-top'),10);padbottom=parseInt($footer.css('padding-bottom'),10);$('body').css('margin-bottom',$footer.outerHeight()+padtop+padbottom)}$(window).load(()=>{matchPageTopToNavbar();matchFooterHeight()});$(window).resize(()=>{matchPageTopToNavbar();matchFooterHeight()});$.fn.scrollView=function scrollView(){return this.each(()=>{$('html, body').animate({scrollTop:0},800)})};$(document).ready(()=>{$('.fancybox').fancybox({nextEffect:'none',prevEffect:'none',backFocus:false,helpers:{title:{type:'inside'}}})});function showImage(channelName,tRanges,imageType,captions){for(let i=0;i<tRanges.length;i+=1){const idBase=`${channelName}_${tRanges[tRanges[i]]}`;const fileBase=`${channelName}-${imageType}-${tRanges[tRanges[i]]}`;document.getElementById(`a_${idBase}`).href=`plots/${fileBase}.png`;document.getElementById(`a_${idBase}`).title=captions[tRanges[i]];document.getElementById(`img_${idBase}`).src=`plots/${fileBase}.png`;document.getElementById(`img_${idBase}`).alt=`${fileBase}.png`}}function downloadCSV(csv,filename){const csvFile=new Blob([csv],{type:'text/csv'});const downloadLink=document.createElement('a');downloadLink.download=filename;downloadLink.href=window.URL.createObjectURL(csvFile);downloadLink.style.display='none';document.body.appendChild(downloadLink);downloadLink.click()}function exportTableToCSV(filename,tableId){const csv=[];const table=document.getElementById(tableId);const rows=table.querySelectorAll('table tr');for(let i=0;i<rows.length;i+=1){const row=[];const cols=rows[i].querySelectorAll('td, th');for(let j=0;j<cols.length;j+=1){row.push(cols[j].innerText)}csv.push(row.join(','))}downloadCSV(csv.join('\n'),filename)}
const regexDayURL=new RegExp('day/\\d{8}/');const regexMonthURL=new RegExp('month/\\d{6}/');const regexYearURL=new RegExp('year/\\d{4}/');function findDateFormat(){const url=window.location.href;if(regexDayURL.test(url)){return'day'}if(regexMonthURL.test(url)){return'month'}if(regexYearURL.test(url)){return'year'}return undefined}function getPageDate(){let datestring;const dateformat=findDateFormat();if(dateformat==='day'){[,datestring]=String(regexDayURL.exec(window.location.href)).split('/');return moment(datestring,'YYYYMMDD')}if(dateformat==='month'){[,datestring]=String(regexMonthURL.exec(window.location.href)).split('/');return moment(datestring,'YYYYMM')}if(dateformat==='year'){[,datestring]=String(regexYearURL.exec(window.location.href)).split('/');return moment(datestring,'YYYY')}throw new Error(`Cannot parse date format '${dateformat}'`)}function moveToDate(ev){let newformat;let newurl;const url=window.location.href;const date=moment(ev.date);if(ev.type==='changeDate'){newformat=`day/${date.format('YYYYMMDD')}/`}else if(ev.type==='changeMonth'){newformat=`month/${date.format('YYYYMM')}/`}else if(ev.type==='changeYear'){newformat=`year/${date.format('YYYY')}/`}if(regexDayURL.test(url)){newurl=url.replace(regexDayURL,newformat)}else if(regexMonthURL.test(url)){newurl=url.replace(regexDayURL,newformat)}else if(regexYearURL.test(url)){newurl=url.replace(regexDayURL,newformat)}else if(window.location.href===document.getElementsByTagName('base')[0].href){newurl=window.location.href+newformat}else{alert('ERROR: Cannot format new date. If the problem persists, please report this at https://github.com/gwpy/gwsumm/issues/')}window.location=newurl}function stepDate(step){const dateformat=findDateFormat();if(!dateformat){return}const date=getPageDate();const newdate=date.add(dateformat,step);if(dateformat==='day'){moveToDate({type:'changeDate',date:newdate})}else if(dateformat==='month'){moveToDate({type:'changeMonth',date:newdate})}else if(dateformat==='year'){moveToDate({type:'changeYear',date:newdate})}}function shortenDate(){const $calendar=jQuery('#calendar');const date_=moment($calendar.data('date'),$calendar.data('date-format').toUpperCase());if($calendar.html().startsWith('Calendar')){return}if(jQuery(document).width()<400){$calendar.html(date_.format('MMM D YYYY'))}else{$calendar.html(` ${date_.format('MMMM D YYYY')} <b class="caret"></b>`)}}function resizeFancyboxIframe(){const width=Math.min(1200,jQuery('.fancybox-skin').width());if(width>document.body.clientWidth){jQuery('.fancybox-iframe').width(width-40)}else{jQuery('.fancybox-iframe').width(width)}jQuery('.fancybox-wrap').width(width+30);jQuery('.fancybox-iframe').height(parseInt(jQuery('.fancybox-iframe').width()*0.5,10));jQuery('.fancybox-wrap').height(parseInt(jQuery('.fancybox-wrap').width()*0.5,10))}function getSelectedFigures(){const stored=sessionStorage.getItem('selectedFigures');const selectedFigures=JSON.parse(stored)||[];return selectedFigures}function setSelectedFigures(value){const stored=JSON.stringify(value);sessionStorage.setItem('selectedFigures',stored)}function appendFigure(src,selectedFigures){if(src.includes('SPECTROGRAM')||src.includes('TRIGGER')){selectedFigures.unshift(src)}else{selectedFigures.push(src)}setSelectedFigures(selectedFigures)}function setupCanvas(canvas){const canv=canvas;const dpr=window.devicePixelRatio||1;const rect=canv.getBoundingClientRect();canv.width=rect.width*dpr;canv.height=rect.height*dpr;const context=canv.getContext('2d');context.scale(dpr,dpr);return context}function overlayFigures(){const dpr=window.devicePixelRatio||1;const selectedFigures=getSelectedFigures();const canvas=document.getElementById('overlay-canvas');const context=setupCanvas(canvas);context.clearRect(0,0,canvas.width,canvas.height);selectedFigures.forEach((src,i)=>{const figure=new Image;figure.src=src;context.drawImage(figure,0,0,canvas.width/dpr,canvas.height/dpr)})}function downloadOverlay(){const canvas=document.getElementById('overlay-canvas');const downloadLink=document.createElement('a');downloadLink.download='overlay.png';downloadLink.href=canvas.toDataURL('image/png');downloadLink.style.display='none';document.body.appendChild(downloadLink);downloadLink.click()}function clearFigures(){const selectedFigures=getSelectedFigures();const canvas=document.getElementById('overlay-canvas');const context=canvas.getContext('2d');context.clearRect(0,0,canvas.width,canvas.height);selectedFigures.length=0;setSelectedFigures(selectedFigures)}jQuery.fn.load_state=function loadState(page){if(jQuery(this).attr('id')===undefined){return}jQuery('#main').load(page);jQuery(this).set_state()};jQuery.fn.set_state=function setState(){if(jQuery(this).attr('id')===undefined){return}const id=jQuery(this).attr('id').substring(6);jQuery('#states').html(`${jQuery(this).attr('title')} <b class="caret"></b>`);jQuery('.state').removeClass('open');jQuery(this).toggleClass('open');window.location.hash=`#${id}`;jQuery('a.ifo-switch').each(function(){const oldurl=jQuery(this).attr('href');const oldhash=oldurl.split('#')[1];jQuery(this).attr('href',oldurl.replace(oldhash,id))})};function resetWidthOnResize(){jQuery('#nav').width(jQuery('#nav').width())}jQuery(window).load(function(){jQuery.ui.dialog.prototype._focusTabbable=function(){};jQuery.fn.bootstrapBtn=jQuery.fn.button.noConflict();if(jQuery('#calendar').length){shortenDate()}const thisbase=document.getElementsByTagName('base')[0].href;jQuery('[data-new-base]').each(function(){const newbase=`${jQuery(this).data('new-base')}/`;jQuery(this).attr('href',window.location.href.replace(thisbase,newbase))});jQuery('#calendar').datepicker({endDate:moment().utc().format('DD/MM/YYYY'),todayHighlight:true,todayBtn:'linked'}).on('changeDate',moveToDate);if(window.location.hash.length>1){const hash=window.location.hash.substring(1);const path=`${window.location.pathname+hash}.html`;jQuery(`#state_${hash}`).load_state(path)}jQuery('.fancybox').fancybox({selector:'[data-fancybox-group="images"]',nextEffect:'none',prevEffect:'none',width:1200,loop:true,backFocus:false,iframe:{scrolling:'no'},scrolling:'no',beforeShow:resizeFancyboxIframe,helpers:{overlay:{locked:false},title:{type:'inside'}}});jQuery('.fancybox-stamp').fancybox({width:1000,height:500,showNavArrows:false,padding:0,title:this.title,href:jQuery(this).attr('href'),type:'iframe'});jQuery('.dropdown-toggle').click(function(){if(jQuery(document).width()<992){return}const target=jQuery(this).nextAll('.dropdown-menu');const dropleft=jQuery(this).offset().left;const dropwidth=target.width();const left=jQuery(window).width();const offright=dropleft+dropwidth>left;if(offright){target.addClass('pull-right')}});jQuery('.dialog').dialog({autoOpen:false,draggable:false,height:0.8*jQuery(window).height(),width:0.9*jQuery(window).width(),modal:true,show:true,hide:true});jQuery('body').on('click','.ui-widget-overlay',()=>{jQuery('.dialog').dialog('close')});jQuery('.btn-open').click(function(){const id=jQuery(this).data('id');jQuery(id).dialog('open')});jQuery('#overlay-figures').click(overlayFigures);jQuery('#download-overlay').click(downloadOverlay);jQuery('#clear-figures').click(clearFigures)});jQuery(document).ajaxComplete((ev,xhr,settings)=>{jQuery('.fancybox').tooltip();jQuery('.fancybox-stamp').tooltip();jQuery('.icon-bar a').tooltip();jQuery('.btn-float').tooltip();jQuery('.btn').tooltip();jQuery('.img-responsive').draggable({helper:'clone',scroll:false,stack:'.img-responsive'});jQuery('#overlay-btn').droppable({accept:'.img-responsive',classes:{'ui-droppable-active':'ui-state-highlight'},tolerance:'pointer',drop(evnt,ui){ev.preventDefault();const selectedFigures=getSelectedFigures();const src=ui.draggable.attr('src');if(selectedFigures.indexOf(src)===-1){appendFigure(src,selectedFigures)}}})});jQuery(window).resize(()=>{if(jQuery('#calendar').length){shortenDate()}});
